<html>

<head>
    <script src="initShaders.js"></script>
</head>

<body>
    <canvas id="cvs">不支持canvas</canvas>
    <script>
        const ctx = document.getElementById('cvs')
        const gl = ctx.getContext('webgl')

        const VSHADER_SOURCE = `
        attribute vec4 a_Position;
        attribute float a_PointSize;
        void main() {
            gl_Position = a_Position;
            gl_PointSize = a_PointSize;                        
        }`

        const FSHADER_SOURCE = `
        void main() {
            gl_FragColor  = vec4(1.0, 0.0, 0.0, 1.0);
        }`

        const program = initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)

        const a_PointSize = gl.getAttribLocation(program, "a_PointSize");
        gl.vertexAttrib1f(a_PointSize, 10.0);

        const a_Position = gl.getAttribLocation(program, 'a_Position');

        const g_points = [];
        ctx.addEventListener('click', (event) => {
            let loc = windowToWebGL(event.clientX, event.clientY)
            g_points.push(loc.x)
            g_points.push(loc.y)

            gl.clear(gl.COLOR_BUFFER_BIT)
            for (let i = 0; i < g_points.length; i += 2) {
                gl.vertexAttrib3f(a_Position, g_points[i], g_points[i + 1], 0.0)
                gl.drawArrays(gl.POINTS, 0, 1)
            }
        });

        gl.clearColor(0.0, 0.0, 0.0, 1.0)
        gl.clear(gl.COLOR_BUFFER_BIT)

        function windowToWebGL(clientX, clientY) {
            let rect = ctx.getBoundingClientRect()
            return {
                x: ((clientX - rect.left) - ctx.width / 2) / (ctx.width / 2),
                y: (ctx.height / 2 - (clientY - rect.top)) / (ctx.height / 2)
            }
        }
    </script>
</body>

</html>